<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Auth Me - Athena</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container py-5">
        <h1>Test /api/auth/me</h1>
        
        <div class="mt-4">
            <button id="testAuthMe" class="btn btn-primary">Test /api/auth/me</button>
            <button id="showToken" class="btn btn-info ms-2">Show Token</button>
            <button id="decodeToken" class="btn btn-warning ms-2">Decode Token</button>
        </div>
        
        <div class="mt-4">
            <h5>Response:</h5>
            <pre id="output" style="background: #f5f5f5; padding: 15px; border-radius: 5px; max-height: 400px; overflow-y: auto;"></pre>
        </div>
    </div>

    <script>
        const outputEl = document.getElementById('output');
        
        function log(message, data = null) {
            let output = message;
            if (data) {
                output += '\n' + JSON.stringify(data, null, 2);
            }
            outputEl.textContent = output + '\n\n' + outputEl.textContent;
        }
        
        // Test /api/auth/me
        document.getElementById('testAuthMe').addEventListener('click', async () => {
            const token = localStorage.getItem('authToken');
            
            if (!token) {
                log('No auth token found in localStorage');
                return;
            }
            
            log('Testing /api/auth/me with token...');
            
            try {
                const response = await fetch('/api/auth/me', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                
                log(`Response Status: ${response.status} ${response.statusText}`);
                
                const data = await response.json();
                log('Response Data:', data);
                
            } catch (error) {
                log('Error:', error.message);
            }
        });
        
        // Show Token
        document.getElementById('showToken').addEventListener('click', () => {
            const token = localStorage.getItem('authToken');
            if (token) {
                log('Token from localStorage:', token);
                log('Token length:', token.length);
            } else {
                log('No token in localStorage');
            }
        });
        
        // Decode Token (without verification)
        document.getElementById('decodeToken').addEventListener('click', () => {
            const token = localStorage.getItem('authToken');
            if (!token) {
                log('No token to decode');
                return;
            }
            
            try {
                // Simple base64 decode without verification
                const parts = token.split('.');
                if (parts.length !== 3) {
                    log('Invalid token format');
                    return;
                }
                
                const payload = JSON.parse(atob(parts[1]));
                log('Decoded token payload:', payload);
                
                // Check expiration
                if (payload.exp) {
                    const expDate = new Date(payload.exp * 1000);
                    log('Token expires at:', expDate.toLocaleString());
                    log('Token expired?', expDate < new Date());
                }
                
            } catch (error) {
                log('Failed to decode token:', error.message);
            }
        });
        
        // Auto-test on load
        document.getElementById('testAuthMe').click();
    </script>
</body>
</html>